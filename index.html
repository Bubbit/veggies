<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Cast.html">Cast</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Cast.html#.array">array</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Cast.html#.object">object</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Cast.html#.objects">objects</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Cast.html#.value">value</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_Cli.html">extensions/Cli</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli.html#.install">install</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_Cli_Cli.html">extensions/Cli/Cli</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli_Cli.html#.getExitCode">getExitCode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli_Cli.html#.getOutput">getOutput</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli_Cli.html#.reset">reset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli_Cli.html#.run">run</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli_Cli.html#.setCwd">setCwd</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli_Cli.html#.setEnvironmentVariable">setEnvironmentVariable</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli_Cli.html#.setEnvironmentVariables">setEnvironmentVariables</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_Cli_hooks.html">extensions/Cli/hooks</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_httpApi.html">extensions/httpApi</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi.html#.install">install</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html">extensions/httpApi/client</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.getResponse">getResponse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.makeRequest">makeRequest</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.reset">reset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.setFormBody">setFormBody</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.setHeader">setHeader</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.setHeaders">setHeaders</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.setJsonBody">setJsonBody</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.setQuery">setQuery</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_httpApi_hooks.html">extensions/httpApi/hooks</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_state.html">extensions/state</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_state.html#.install">install</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_state_State.html">extensions/state/State</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_state_State.html#.get">get</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_state_State.html#.set">set</a></span></li>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><h1>veggies</h1><p><a href="https://www.npmjs.com/package/@ekino/veggies"><img src="https://img.shields.io/npm/v/@ekino/veggies.svg?style=flat-square" alt="NPM version"></a>
<a href="https://travis-ci.org/ekino/veggies"><img src="https://img.shields.io/travis/ekino/veggies.svg?style=flat-square" alt="Travis CI"></a>
<a href="https://coveralls.io/github/ekino/veggies?branch=master"><img src="https://img.shields.io/coveralls/ekino/veggies/master.svg?style=flat-square" alt="Coverage Status"></a>
<a href="https://github.com/prettier/prettier"><img src="https://img.shields.io/badge/styled_with-prettier-ff69b4.svg?style=flat-square" alt="styled with prettier"></a></p>
<p>Veggies is an awesome cucumberjs boilerplate for API/CLI testing.
Great for testing APIs built upon Express, Koa, HAPI, Loopback and others.
It's also the perfect companion for testing CLI applications built with commander, meow &amp; Co. </p>
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#features">Features</a><ul>
<li><a href="#api-testing">API testing</a><ul>
<li><a href="#making-a-simple-request-and-testing-its-status-code">Making a simple request</a></li>
<li><a href="#posting-data">Posting data</a></li>
<li><a href="#using-values-issued-by-a-previous-request">Using values issued by a previous request</a></li>
<li><a href="#type-system">Type system</a></li>
</ul>
</li>
<li><a href="#cli-testing">CLI testing</a> <ul>
<li><a href="#running-a-simple-command-and-checking-its-exit-code">Running a simple command</a></li>
<li><a href="#testing-a-command-error">Testing a command error</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#extensions">Extensions</a><ul>
<li><a href="#state-extension">state</a></li>
<li><a href="#http-api-extension">http API</a></li>
<li><a href="#cli-extension">CLI</a></li>
</ul>
</li>
<li><a href="#examples">Examples</a>    </li>
</ul>
<h2>Installation</h2><p>Using npm:</p>
<pre class="prettyprint source lang-sh"><code>npm install @ekino/veggies</code></pre><p>Or yarn:</p>
<pre class="prettyprint source lang-sh"><code>yarn add @ekino/veggies</code></pre><p>Then all you have to do is installing the provided extensions:</p>
<pre class="prettyprint source lang-javascript"><code>// /support/world.js

const { defineSupportCode } = require('cucumber')
const { state, httpApi, cli } = require('@ekino/veggies')

defineSupportCode(({ setWorldConstructor }) => {
    setWorldConstructor(function() {
        state.extendWorld(this)
        httpApi.extendWorld(this)
        cli.extendWorld(this)
    })
})

state.install(defineSupportCode)
httpApi.install({
    baseUrl: 'http://localhost:3000',
})(defineSupportCode)
cli.install(defineSupportCode)</code></pre><h2>Features</h2><h3>API testing</h3><p>For an exhaustive list of all available step definitions you should have a look
at the <a href="https://github.com/ekino/veggies/blob/master/src/extensions/http_api/definitions.js">definitions file</a>.</p>
<h4>Making a simple request and testing its status code</h4><pre class="prettyprint source lang-gherkin"><code>Scenario: Using GitHub API
  Given I set User-Agent request header to veggies/1.0
  When I GET https://api.github.com/
  Then I should receive a 200 HTTP status code</code></pre><h4>Posting data</h4><p>You can easily issue a POST request using json payload</p>
<pre class="prettyprint source lang-gherkin"><code>Scenario: Creating a resource using json payload
  Given I set request json body
    | username | plouc |
    | gender   | male  |
  When I POST https://my-api.io/users
  Then I should receive a 201 HTTP status code</code></pre><p>You can also use form encoded values, all you have to do is
to change <code>json</code> for <code>form</code></p>
<pre class="prettyprint source lang-gherkin"><code>Scenario: Creating a resource using json payload
  Given I set request form body
    | username | plouc |
    | gender   | male  |
  When I POST https://my-api.io/users
  Then I should receive a 201 HTTP status code</code></pre><h4>Using values issued by a previous request</h4><p>Imagine you want to test a resource creation and then that you're able
to fetch this new entity through the API.</p>
<p>If resource id is generated by your API, it will be impossible to make
the second call because id is unknown. </p>
<p>To solve this problem you have the ability to collect data from
a previous response, store it in the state and inject it at various
places using placeholders.</p>
<p>The following example calls the root GitHub API endpoint,
extracts the <code>emojis_url</code> value from the json response and
stores it in the current state under the <code>emojisUrl</code> key,
then it uses this value to make its next request.</p>
<pre class="prettyprint source lang-gherkin"><code>Scenario: Using GitHub API
  Given I set User-Agent request header to veggies/1.0
  When I GET https://api.github.com/
  And I pick response json emojis_url as emojisUrl
  And I GET {{emojisUrl}}
  Then I should receive a 200 HTTP status code</code></pre><p>It's even possible to mix this approach with scenario outline to have more concise tests
(at the cost of clarity thought).</p>
<p>The following example will generates 3 scenario at runtime
using different response values for second request.</p>
<pre class="prettyprint source lang-gherkin"><code>Scenario Outline: Fetching &lt;key> API endpoint from root endpoint
  Given I set User-Agent request header to veggies/1.0
  When I GET https://api.github.com/
  Then I should receive a 200 HTTP status code
  When I pick response json &lt;key> as &lt;key>
  And I GET {{&lt;key>}}
  Then I should receive a 200 HTTP status code

  Examples:
    | key              |
    | emojis_url       |
    | feeds_url        |
    | public_gists_url |</code></pre><h4>Type system</h4><p>When testing json based APIs, which is a standard nowadays, you have to be aware of data types
for sending payloads or making assertions on received responses, that's why veggies provides
a lightweight type systems.</p>
<p>The following directives are available:</p>
<table>
<thead>
<tr>
<th>directive</th>
<th>type</th>
<th>example</th>
<th>output</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>((undefined))</code></td>
<td><code>undefined</code></td>
<td><code>((undefined))</code></td>
<td><code>undefined</code></td>
</tr>
<tr>
<td><code>((null))</code></td>
<td><code>null</code></td>
<td><code>((null))</code></td>
<td><code>null</code></td>
</tr>
<tr>
<td><code>&lt;value&gt;((string))</code></td>
<td><code>string</code></td>
<td><code>hi((string))</code></td>
<td><code>'hi'</code></td>
</tr>
<tr>
<td><code>&lt;value&gt;((number))</code></td>
<td><code>number</code></td>
<td><code>1((number))</code></td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>&lt;value&gt;((boolean))</code></td>
<td><code>boolean</code></td>
<td><code>true((boolean))</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>&lt;value&gt;((array))</code></td>
<td><code>Array</code></td>
<td><code>one,two,three((array))</code></td>
<td><code>['one', 'two', 'three']</code></td>
</tr>
</tbody>
</table>
<p>You can now use those directive for most of step definitions accepting data tables.</p>
<p>For example you can use it to post typed json data:</p>
<pre class="prettyprint source lang-gherkin"><code>Scenario: Creating a resource using typed json payload
  Given I set request json body
    | username  | plouc((string))          |
    | team_id   | 1((number))              |
    | is_active | true((boolean))          |
    | hobbies   | drawing,hacking((array)) |
  When I POST https://my-api.io/users
  Then I should receive a 201 HTTP status code</code></pre><p>which will generate the following payload:</p>
<pre class="prettyprint source lang-json"><code>{
  &quot;username&quot;: &quot;plouc&quot;,
  &quot;team_id&quot;: 1,
  &quot;is_active&quot;: true,
  &quot;hobbies&quot;: [
    &quot;drawing&quot;,
    &quot;hacking&quot;
  ]
}</code></pre><h3>CLI testing</h3><p>For an exhaustive list of all available step definitions you should have a look
at the <a href="https://github.com/ekino/veggies/blob/master/src/extensions/cli/definitions.js">definitions file</a>.</p>
<h4>Running a simple command and checking its exit code</h4><pre class="prettyprint source lang-gherkin"><code>Scenario: Getting info about installed yarn version
  When I run command yarn --version
  Then exit code should be 0</code></pre><h4>Testing a command error</h4><pre class="prettyprint source lang-gherkin"><code>Scenario: Running an invalid command
  When I run command yarn invalid
  Then exit code should be 1
  And stderr should contain error Command &quot;invalid&quot; not found.</code></pre><h2>Extensions</h2><p>This module is composed of several extensions.</p>
<p><a href="#state-extension">state</a> | <a href="#http-api-extension">http API</a> | <a href="#cli-extension">CLI</a></p>
<h3>state extension</h3><p>The state extension is a simple helper used to persist state between steps &amp; eventually scenarios
(but you should try to avoid coupling scenarios).</p>
<p>It's involved for example when <a href="#using-values-issued-by-a-previous-request">you want to collect values issued by a previous request</a>
when using the <a href="#http-api-extension">http API extension</a>.</p>
<p>To install the extension, you should add the following snippet to your <code>world</code> file:</p>
<pre class="prettyprint source lang-javascript"><code>// /support/world.js

const { defineSupportCode } = require('cucumber')
const { state } = require('@ekino/veggies')

defineSupportCode(({ setWorldConstructor }) => {
    setWorldConstructor(function() {
        state.extendWorld(this)
    })
})

state.install(defineSupportCode)</code></pre><p>When installed, you can access it from the global cucumber context in your own step definitions.
For available methods on the state, please refer to its own
<a href="https://ekino.github.io/veggies/module-extensions_state_State.html">documentation</a>.</p>
<pre class="prettyprint source lang-javascript"><code>defineSupportCode(({ When }) => {
    When(/^I do something useful$/, function() {
        const stateValue = this.state.get('whatever')
        // …
    })
})</code></pre><h3>http API extension</h3><p>The http API extension relies on the <a href="#state-extension">state extension</a>,
so make sure it's registered prior to installation.</p>
<p>To install the extension, you should add the following snippet to your <code>world</code> file:</p>
<pre class="prettyprint source lang-javascript"><code>// /support/world.js

const { defineSupportCode } = require('cucumber')
const { state, httpApi } = require('@ekino/veggies')

defineSupportCode(({ setWorldConstructor }) => {
    setWorldConstructor(function() {
        state.extendWorld(this)
        httpApi.extendWorld(this)
    })
})

state.install(defineSupportCode)
httpApi.install({
    baseUrl: 'http://localhost:3000',
})(defineSupportCode)</code></pre><p>When installed, you can access its client from the global cucumber context in your own step definitions.
For available methods on the client, please refer to its own
<a href="https://ekino.github.io/veggies/module-extensions_httpApi_client.html">documentation</a>.</p>
<pre class="prettyprint source lang-javascript"><code>defineSupportCode(({ When }) => {
    When(/^I do something useful$/, function() {
        return this.httpApiClient.makeRequest(/* … */)
    })
})</code></pre><h3>CLI extension</h3><p>The CLI extension relies on the <a href="#state-extension">state extension</a>,
so make sure it's registered prior to installation.</p>
<p>To install the extension, you should add the following snippet to your <code>world</code> file:</p>
<pre class="prettyprint source lang-javascript"><code>// /support/world.js

const { defineSupportCode } = require('cucumber')
const { state, cli } = require('@ekino/veggies')

defineSupportCode(({ setWorldConstructor }) => {
    setWorldConstructor(function() {
        state.extendWorld(this)
        cli.extendWorld(this)
    })
})

state.install(defineSupportCode)
cli.install(defineSupportCode)</code></pre><p>When installed, you can access it from the global cucumber context in your own step definitions.
For available methods on the client, please refer to its own
<a href="https://ekino.github.io/veggies/module-extensions_httpApi_client.html">documentation</a>.</p>
<pre class="prettyprint source lang-javascript"><code>defineSupportCode(({ When }) => {
    Then(/^I check something from the CLI output$/, function() {
        const out = this.cli.getOutput()
        // …
    })
})</code></pre><h2>Examples</h2><p>This repository comes with few examples, in order to run them, invoke the following script:</p>
<pre class="prettyprint source lang-sh"><code>yarn run examples</code></pre><p>If you want to only run certain examples, you can use tags, for example to run cli extension examples:</p>
<pre class="prettyprint source lang-sh"><code>yarn run examples -- --tags @cli</code></pre></article>
    </section>






</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Thu Jun 29 2017 10:25:34 GMT+0900 (JST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
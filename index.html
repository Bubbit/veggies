<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Cast.html">Cast</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Cast.html#.addType">addType</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Cast.html#.array">array</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Cast.html#.object">object</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Cast.html#.objects">objects</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Cast.html#.value">value</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Cast.html#~CastFunction">CastFunction</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_Cli.html">extensions/Cli</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli.html#.extendWorld">extendWorld</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli.html#.install">install</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_Cli_Cli.html">extensions/Cli/Cli</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli_Cli.html#.getCwd">getCwd</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli_Cli.html#.getExitCode">getExitCode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli_Cli.html#.getOutput">getOutput</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli_Cli.html#.reset">reset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli_Cli.html#.run">run</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli_Cli.html#.setCwd">setCwd</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli_Cli.html#.setEnvironmentVariable">setEnvironmentVariable</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_Cli_Cli.html#.setEnvironmentVariables">setEnvironmentVariables</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_Cli_hooks.html">extensions/Cli/hooks</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_FileSystem.html">extensions/FileSystem</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_FileSystem.html#.extendWorld">extendWorld</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_FileSystem.html#.install">install</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_FileSystem_FileSystem.html">extensions/FileSystem/FileSystem</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_FileSystem_FileSystem.html#.getFileContent">getFileContent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_FileSystem_FileSystem.html#.getFileInfo">getFileInfo</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_fixtures.html">extensions/fixtures</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_fixtures.html#.extendWorld">extendWorld</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_fixtures.html#.install">install</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_fixtures_FixturesLoader.html">extensions/fixtures/FixturesLoader</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_fixtures_FixturesLoader.html#.configure">configure</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_fixtures_FixturesLoader.html#.load">load</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_fixtures_FixturesLoader.html#.loadJson">loadJson</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_fixtures_FixturesLoader.html#.loadModule">loadModule</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_fixtures_FixturesLoader.html#.loadText">loadText</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_fixtures_FixturesLoader.html#.loadYaml">loadYaml</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_fixtures_FixturesLoader.html#.reset">reset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_fixtures_FixturesLoader.html#.setFeatureUri">setFeatureUri</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_fixtures_hooks.html">extensions/fixtures/hooks</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_httpApi.html">extensions/httpApi</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi.html#.extendWorld">extendWorld</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi.html#.install">install</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html">extensions/httpApi/client</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.clearBody">clearBody</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.clearHeaders">clearHeaders</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.clearRequestCookies">clearRequestCookies</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.disableCookies">disableCookies</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.enableCookies">enableCookies</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.getCookie">getCookie</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.getCookies">getCookies</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.getResponse">getResponse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.makeRequest">makeRequest</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.reset">reset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.setCookie">setCookie</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.setFormBody">setFormBody</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.setHeader">setHeader</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.setHeaders">setHeaders</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.setJsonBody">setJsonBody</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_httpApi_client.html#.setQuery">setQuery</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_httpApi_hooks.html">extensions/httpApi/hooks</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_state.html">extensions/state</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_state.html#.extendWorld">extendWorld</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_state.html#.install">install</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-extensions_state_State.html">extensions/state/State</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_state_State.html#.get">get</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-extensions_state_State.html#.set">set</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#countNestedProperties">countNestedProperties</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#hasExtension">hasExtension</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#mustGetResponse">mustGetResponse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#registerExtension">registerExtension</a></span></li>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><p><a href="https://ekino.github.io/veggies/"><img src="https://raw.githubusercontent.com/ekino/veggies/master/doc/veggies-banner.png" alt="veggies"></a></p>
<p><a href="https://www.npmjs.com/package/@ekino/veggies"><img src="https://img.shields.io/npm/v/@ekino/veggies.svg?style=flat-square" alt="NPM version"></a>
<a href="https://travis-ci.org/ekino/veggies"><img src="https://img.shields.io/travis/ekino/veggies.svg?style=flat-square" alt="Travis CI"></a>
<a href="https://coveralls.io/github/ekino/veggies?branch=master"><img src="https://img.shields.io/coveralls/ekino/veggies/master.svg?style=flat-square" alt="Coverage Status"></a>
<a href="https://github.com/prettier/prettier"><img src="https://img.shields.io/badge/styled_with-prettier-ff69b4.svg?style=flat-square" alt="styled with prettier"></a></p>
<p><a href="https://github.com/ekino/veggies/watchers"><img src="https://img.shields.io/github/watchers/ekino/veggies.svg?style=social" alt="Watch on GitHub"></a>
<a href="https://github.com/ekino/veggies/stargazers"><img src="https://img.shields.io/github/stars/ekino/veggies.svg?style=social" alt="Star on GitHub"></a>
<a href="https://twitter.com/intent/tweet?text=Check%20out%20veggies!%20https://github.com/ekino/veggies%20%F0%9F%91%8D"><img src="https://img.shields.io/twitter/url/https/github.com/ekino/veggies.svg?style=social" alt="Tweet"></a></p>
<p>Veggies is an awesome cucumberjs library for API/CLI testing.
Great for testing APIs built upon Express, Koa, HAPI, Loopback and others.
It's also the perfect companion for testing CLI applications built with commander, meow &amp; Co. </p>
<ul>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#features">Features</a><ul>
<li><a href="#api-testing">API testing</a><ul>
<li><a href="#making-a-simple-request-and-testing-its-status-code">Making a simple request</a></li>
<li><a href="#posting-data">Posting data</a></li>
<li><a href="#posting-data-using-fixture-file">Posting data using fixture file</a></li>
<li><a href="#using-values-issued-by-a-previous-request">Using values issued by a previous request</a></li>
<li><a href="#using-cookies">Using cookies</a></li>
<li><a href="#testing-json-response">Testing json response</a></li>
<li><a href="#testing-response-headers">Testing response headers</a></li>
<li><a href="#debugging-failing-api-tests">Debugging failing API tests</a></li>
<li><a href="#type-system">Type system</a></li>
</ul>
</li>
<li><a href="#cli-testing">CLI testing</a> <ul>
<li><a href="#running-a-simple-command-and-checking-its-exit-code">Running a simple command</a></li>
<li><a href="#testing-a-command-error">Testing a command error</a></li>
</ul>
</li>
<li><a href="#file-system-testing">File System testing</a>   <ul>
<li><a href="#testing-file-content">Testing file content</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#extensions">Extensions</a><ul>
<li><a href="#state-extension"><strong>state</strong></a> <a href="#state-installation">install</a> | <a href="#state-gherkin-expressions">gherkin expressions</a> | <a href="#state-low-level-api">low level API</a></li>
<li><a href="#fixtures-extension"><strong>fixtures</strong></a> <a href="#fixtures-installation">install</a> | <a href="#fixtures-low-level-api">low level API</a></li>
<li><a href="#http-api-extension"><strong>http API</strong></a> <a href="#http-api-installation">install</a> | <a href="#http-api-gherkin-expressions">gherkin expressions</a> | <a href="#http-api-low-level-api">low level API</a></li>
<li><a href="#cli-extension"><strong>CLI</strong></a> <a href="#cli-installation">install</a> | <a href="#cli-gherkin-expressions">gherkin expressions</a> | <a href="#cli-low-level-api">low level API</a></li>
<li><a href="#file-system-extension"><strong>fileSystem</strong></a> <a href="#file-system-installation">install</a> | <a href="#file-system-gherkin-expressions">gherkin expressions</a> | <a href="#file-system-low-level-api">low level API</a></li>
</ul>
</li>
<li><a href="#helpers">Helpers</a><ul>
<li><a href="#cast-helper"><strong>cast</strong></a> <a href="#cast-usage">usage</a> | <a href="#add-a-type">add a type</a></li>
</ul>
</li>
<li><a href="#examples">Examples</a>   </li>
</ul>
<h2>Requirements</h2><ul>
<li>Node.js <code>&gt;=6.0.0</code></li>
<li>cucumber <code>&gt;=2.0.0</code></li>
</ul>
<h2>Installation</h2><p>Using npm:</p>
<pre class="prettyprint source lang-sh"><code>npm install @ekino/veggies</code></pre><p>Or yarn:</p>
<pre class="prettyprint source lang-sh"><code>yarn add @ekino/veggies</code></pre><p>Then all you have to do is installing the provided extensions:</p>
<pre class="prettyprint source lang-javascript"><code>// /support/world.js

const { defineSupportCode } = require('cucumber')
const { state, fixtures, httpApi, cli } = require('@ekino/veggies')

defineSupportCode(({ setWorldConstructor }) => {
    setWorldConstructor(function() {
        state.extendWorld(this)
        fixtures.extendWorld(this)
        httpApi.extendWorld(this)
        cli.extendWorld(this)
    })
})

state.install(defineSupportCode)
fixtures.install(defineSupportCode)
httpApi.install({
    baseUrl: 'http://localhost:3000',
})(defineSupportCode)
cli.install(defineSupportCode)</code></pre><h2>Features</h2><h3>API testing</h3><p>For full feature list, have a look at
<a href="#http-api-gherkin-expressions">available gherkin expressions</a>
for the <a href="#http-api-extension">dedicated extension</a>.</p>
<h4>Making a simple request and testing its status code</h4><pre class="prettyprint source lang-gherkin"><code>Scenario: Using GitHub API
  Given I set User-Agent request header to veggies/1.0
  When I GET https://api.github.com/
  Then I should receive a 200 HTTP status code</code></pre><h4>Posting data</h4><p>You can easily issue a POST request using json payload</p>
<pre class="prettyprint source lang-gherkin"><code>Scenario: Creating a resource using json payload
  Given I set request json body
    | username | plouc |
    | gender   | male  |
  When I POST https://my-api.io/users
  Then I should receive a 201 HTTP status code</code></pre><p>You can also use form encoded values, all you have to do is
to change <code>json</code> for <code>form</code></p>
<pre class="prettyprint source lang-gherkin"><code>Scenario: Creating a resource using json payload
  Given I set request form body
    | username | plouc |
    | gender   | male  |
  When I POST https://my-api.io/users
  Then I should receive a 201 HTTP status code</code></pre><h4>Posting data using fixture file</h4><p>Putting large data payloads inside your scenarios can reduce legibility,
to improve this, you can use the <a href="#fixtures-extension">fixtures extension</a> to define it.</p>
<pre class="prettyprint source lang-yaml"><code># /features/user/fixtures/user.yml

username: plouc
gender:   male</code></pre><pre class="prettyprint source lang-gherkin"><code># /features/user/create_user.feature

Scenario: Creating a resource using json payload
  Given I set request form body from user
  When I POST https://my-api.io/users
  Then I should receive a 201 HTTP status code</code></pre><h4>Using values issued by a previous request</h4><p>Imagine you want to test a resource creation and then that you're able
to fetch this new entity through the API.</p>
<p>If resource id is generated by your API, it will be impossible to make
the second call because id is unknown. </p>
<p>To solve this problem you have the ability to collect data from
a previous response, store it in the state and inject it at various
places using placeholders.</p>
<p>The following example calls the root GitHub API endpoint,
extracts the <code>emojis_url</code> value from the json response and
stores it in the current state under the <code>emojisUrl</code> key,
then it uses this value to make its next request.</p>
<pre class="prettyprint source lang-gherkin"><code>Scenario: Using GitHub API
  Given I set User-Agent request header to veggies/1.0
  When I GET https://api.github.com/
  And I pick response json emojis_url as emojisUrl
  And I GET {{emojisUrl}}
  Then I should receive a 200 HTTP status code</code></pre><p>It's even possible to mix this approach with scenario outline to have more concise tests
(at the cost of clarity thought).</p>
<p>The following example will generates 3 scenario at runtime
using different response values for second request.</p>
<pre class="prettyprint source lang-gherkin"><code>Scenario Outline: Fetching &lt;key> API endpoint from root endpoint
  Given I set User-Agent request header to veggies/1.0
  When I GET https://api.github.com/
  Then I should receive a 200 HTTP status code
  When I pick response json &lt;key> as &lt;key>
  And I GET {{&lt;key>}}
  Then I should receive a 200 HTTP status code

  Examples:
    | key              |
    | emojis_url       |
    | feeds_url        |
    | public_gists_url |</code></pre><h4>Using cookies</h4><p>Cookies are disabled by default, but you've got the ability to enable/disable the feature using a gherkin <code>Given</code> expression.
Be warned that cookies do not persist across scenarios in order to ensure they're autonomous.
If you really need to keep a cookie for multiple scenarios, you should consider using a custom step definition
and/or using the <a href="#state-extension">state extention</a> to store it.</p>
<pre class="prettyprint source lang-gherkin"><code>Scenario: Enabling cookies
  Given I enable cookies
  # …

Scenario: Disabling cookies
  Given I disable cookies
  # …</code></pre><p>See <a href="#http-api-gherkin-expressions">definitions</a> for all available cookies related gherkin expressions.</p>
<h4>Testing json response</h4><p><strong>veggies</strong> gives you the ability to check json responses, the corresponding gherkin expression is:</p>
<pre class="prettyprint source"><code>/^(?:I )?json response should (fully )?match$/</code></pre><p>Checking json response properties equal value:</p>
<pre class="prettyprint source lang-gherkin"><code>Scenario: Fetching some json response from the internets
    When I GET http://whatever.io/things/1
    Then json response should match
      | field           | matcher | value |
      | name            | equal   | thing |
      | address.country | equal   | Japan |</code></pre><p>Checking json response properties contain value:</p>
<pre class="prettyprint source lang-gherkin"><code>Scenario: Fetching some json response from the internets
    When I GET http://whatever.io/things/1
    Then json response should match
      | field           | matcher | value |
      | name            | contain | ing   |
      | address.country | contain | Jap   |</code></pre><p>Checking json response properties match value:</p>
<pre class="prettyprint source lang-gherkin"><code>Scenario: Fetching some json response from the internets
    When I GET http://whatever.io/things/1
    Then json response should match
      | field           | matcher | value     |
      | name            | match   | ^(.+)ing$ |
      | address.country | match   | ^Jap(.+)$ |</code></pre><p>By default this assertion does not check for full match.
Properties not listed will just be ignored, if you want a full match:</p>
<pre class="prettyprint source lang-gherkin"><code>Scenario: Fetching some json response from the internets
    When I GET http://whatever.io/things/1
    Then json response should fully match
      | field           | matcher | value     |
      | name            | match   | ^(.+)ing$ |
      | address.country | equal   | Japan     |</code></pre><p>Now if the json contains extra properties, the test will fail.</p>
<p>Available matchers are:</p>
<table>
<thead>
<tr>
<th>matcher</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>match</code></td>
<td>property must match given regexp</td>
</tr>
<tr>
<td><code>matches</code></td>
<td>see <code>match</code></td>
</tr>
<tr>
<td><code>contain</code></td>
<td>property must contain given value</td>
</tr>
<tr>
<td><code>contains</code></td>
<td>see <code>contain</code></td>
</tr>
<tr>
<td><code>defined</code></td>
<td>property must not be <code>undefined</code></td>
</tr>
<tr>
<td><code>present</code></td>
<td>see <code>defined</code></td>
</tr>
<tr>
<td><code>equal</code></td>
<td>property must equal given value</td>
</tr>
<tr>
<td><code>equals</code></td>
<td>see <code>equal</code></td>
</tr>
</tbody>
</table>
<h4>Testing response headers</h4><p>In order to check response headers, you have the following gherkin expression available:</p>
<pre class="prettyprint source"><code>/^response header (.+) should (not )?(equal|contain|match) (.+)$/</code></pre><p>It supports multiple combinations to verify header value conforms to what you expect.
This example illustrates its different features:</p>
<pre class="prettyprint source lang-gherkin"><code>Scenario: Testing header related expectations
    When I GET http://whatever.io/
    Then response header X-Whatever-A should equal whatever
    And response header X-Whatever-B should not equal whatever
    And response header X-Whatever-C should contain part
    And response header X-Whatever-D should not contain part
    And response header X-Whatever-E should match ^(thing|other)$
    And response header X-Whatever-F should not match ^(thing|other)$</code></pre><p>If the header does not exist, the test will fail.</p>
<h4>Debugging failing API tests</h4><p>When testing APIs using cucumber, we often faced situations were we didn't understand why a given test were failing.
The dirty fix was to add some nasty <code>console.log()</code> everywhere, that's why <strong>veggies</strong> provides helpers to dump response properties.</p>
<pre class="prettyprint source lang-gherkin"><code>Scenario: Fetching something from the internets
    When I GET http://whatever.io/things
    And dump response body
    And dump response headers
    And dump response cookies</code></pre><p>You'll now have the response body/headers/cookies dumped in your terminal.
You should disable those steps when the test is fixed as it can be noisy enough.</p>
<h4>Type system</h4><p>When testing json based APIs, which is a standard nowadays, you have to be aware of data types
for sending payloads or making assertions on received responses, that's why veggies provides
a lightweight type systems.</p>
<p>The following directives are available:</p>
<table>
<thead>
<tr>
<th>directive</th>
<th>type</th>
<th>example</th>
<th>output</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>((undefined))</code></td>
<td><code>undefined</code></td>
<td><code>((undefined))</code></td>
<td><code>undefined</code></td>
</tr>
<tr>
<td><code>((null))</code></td>
<td><code>null</code></td>
<td><code>((null))</code></td>
<td><code>null</code></td>
</tr>
<tr>
<td><code>&lt;value&gt;((string))</code></td>
<td><code>string</code></td>
<td><code>hi((string))</code></td>
<td><code>'hi'</code></td>
</tr>
<tr>
<td><code>&lt;value&gt;((number))</code></td>
<td><code>number</code></td>
<td><code>1((number))</code></td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>&lt;value&gt;((boolean))</code></td>
<td><code>boolean</code></td>
<td><code>true((boolean))</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>&lt;value&gt;((array))</code></td>
<td><code>Array</code></td>
<td><code>one,two,three((array))</code></td>
<td><code>['one', 'two', 'three']</code></td>
</tr>
</tbody>
</table>
<p>You can now use those directive for most of step definitions accepting data tables.</p>
<p>For example you can use it to post typed json data:</p>
<pre class="prettyprint source lang-gherkin"><code>Scenario: Creating a resource using typed json payload
  Given I set request json body
    | username  | plouc((string))          |
    | team_id   | 1((number))              |
    | is_active | true((boolean))          |
    | hobbies   | drawing,hacking((array)) |
  When I POST https://my-api.io/users
  Then I should receive a 201 HTTP status code</code></pre><p>which will generate the following payload:</p>
<pre class="prettyprint source lang-json"><code>{
  &quot;username&quot;: &quot;plouc&quot;,
  &quot;team_id&quot;: 1,
  &quot;is_active&quot;: true,
  &quot;hobbies&quot;: [
    &quot;drawing&quot;,
    &quot;hacking&quot;
  ]
}</code></pre><h3>CLI testing</h3><p>For full feature list, have a look at
<a href="#cli-gherkin-expressions">available gherkin expressions</a>
for the <a href="#cli-extension">dedicated extension</a>.</p>
<h4>Running a simple command and checking its exit code</h4><pre class="prettyprint source lang-gherkin"><code>Scenario: Getting info about installed yarn version
  When I run command yarn --version
  Then exit code should be 0</code></pre><h4>Testing a command error</h4><pre class="prettyprint source lang-gherkin"><code>Scenario: Running an invalid command
  When I run command yarn invalid
  Then exit code should be 1
  And stderr should contain error Command &quot;invalid&quot; not found.</code></pre><h3>File System testing</h3><h4>Testing file content</h4><p>In order to check file content, you have the following gherkin expression available:</p>
<pre class="prettyprint source"><code>/^file (.+) content (not )?(equal|contain|match) (.+)$/</code></pre><p>It supports multiple combinations to verify file content conforms to what you expect.
This example illustrates its different features:</p>
<pre class="prettyprint source lang-gherkin"><code>Scenario: Testing file content related expectations
    Then file sample_A.text content should equal whatever
    And file sample_B.text content should not equal whatever
    And file sample_C.text content should contain part
    And file sample_D.text content should not contain part
    And file sample_E.text content should match ^(thing|other)$
    And file sample_F.text content should not match ^(thing|other)$</code></pre><p>If the file does not exist, the test will fail.</p>
<h2>Extensions</h2><p>This module is composed of several extensions.</p>
<p><a href="#state-extension">state</a> | <a href="#fixtures-extension">fixtures</a> | <a href="#http-api-extension">http API</a> | <a href="#cli-extension">CLI</a></p>
<h3>state extension</h3><p>The state extension is a simple helper used to persist state between steps &amp; eventually scenarios
(but you should try to avoid coupling scenarios).</p>
<p>It's involved for example when <a href="#using-values-issued-by-a-previous-request">you want to collect values issued by a previous request</a>
when using the <a href="#http-api-extension">http API extension</a>.</p>
<h4>state installation</h4><p>To install the extension, you should add the following snippet to your <code>world</code> file:</p>
<pre class="prettyprint source lang-javascript"><code>// /support/world.js

const { defineSupportCode } = require('cucumber')
const { state } = require('@ekino/veggies')

defineSupportCode(({ setWorldConstructor }) => {
    setWorldConstructor(function() {
        state.extendWorld(this)
    })
})

state.install(defineSupportCode)</code></pre><h4>State gherkin expressions</h4><pre class="prettyprint source lang-yaml"><code>Given:
  - /^(?:I )?set state (.+) to (.+)$/

When:
  - /^(?:I )?clear state$/
  - /^(?:I )?dump state$/

Then:
  # No definitions</code></pre><h4>State low level API</h4><p>When installed, you can access it from the global cucumber context in your own step definitions.
For available methods on the state, please refer to its own
<a href="https://ekino.github.io/veggies/module-extensions_state_State.html">documentation</a>.</p>
<pre class="prettyprint source lang-javascript"><code>defineSupportCode(({ When }) => {
    When(/^I do something useful$/, function() {
        const stateValue = this.state.get('whatever')
        // …
    })
})</code></pre><h3>Fixtures extension</h3><p>The fixtures extension can be used to load data from files during testing.</p>
<p>It supports the following file extensions:</p>
<ul>
<li><strong>.yaml</strong>, <strong>.yml</strong> - loads and parses a yaml file, result can be <code>Object</code> or <code>Array</code></li>
<li><strong>.txt</strong> - loads text content, result is a <code>string</code></li>
<li><strong>.json</strong> - loads json, result is and <code>Object</code></li>
<li><strong>.js</strong> - loads a javascript module, the module must exports load function via <code>module.exports</code>,
result can be whatever type the function returns </li>
</ul>
<h4>Fixtures installation</h4><p>To install the extension, you should add the following snippet to your <code>world</code> file:</p>
<pre class="prettyprint source lang-javascript"><code>// /support/world.js

const { defineSupportCode } = require('cucumber')
const { fixtures } = require('@ekino/veggies')

defineSupportCode(({ setWorldConstructor }) => {
    setWorldConstructor(function() {
        fixtures.extendWorld(this)
    })
})

fixtures.install(defineSupportCode)</code></pre><h4>Fixtures low level API</h4><p>When installed, you can access it from the global cucumber context in your own step definitions.
For available methods on the fixtures loader, please refer to its own
<a href="https://ekino.github.io/veggies/module-extensions_fixtures_FixturesLoader.html">documentation</a>.</p>
<pre class="prettyprint source lang-javascript"><code>defineSupportCode(({ When }) => {
    When(/^I do something useful with fixtures$/, function() {
        return this.fixtures.load('whatever')
            .then(fixture => {
                // …
            })
    })
})</code></pre><h3>http API extension</h3><h4>http API installation</h4><p>The http API extension relies on the <a href="#state-extension">state</a> &amp;
<a href="#fixtures-extension">fixtures</a> extensions, so make sure they're
registered prior to installation.</p>
<p>To install the extension, you should add the following snippet
to your <code>world</code> file:</p>
<pre class="prettyprint source lang-javascript"><code>// /support/world.js

const { defineSupportCode } = require('cucumber')
const { state, fixtures, httpApi } = require('@ekino/veggies')

defineSupportCode(({ setWorldConstructor }) => {
    setWorldConstructor(function() {
        state.extendWorld(this)
        fixtures.extendWorld(this)
        httpApi.extendWorld(this)
    })
})

state.install(defineSupportCode)
httpApi.install({
    baseUrl: 'http://localhost:3000',
})(defineSupportCode)</code></pre><h4>http API gherkin expressions</h4><pre class="prettyprint source lang-yaml"><code>Given:
  - /^(?:I )?set request headers$/
  - /^(?:I )?set ([a-zA-Z0-9-]+) request header to (.+)$/
  - /^(?:I )?clear request headers/
  - /^(?:I )?set request json body$/
  - /^(?:I )?set request json body from (.+)$/
  - /^(?:I )?set request form body$/
  - /^(?:I )?set request form body from (.+)$/
  - /^(?:I )?clear request body$/
  - /^(?:I )?set request query$/
  - /^(?:I )?pick response json (.+) as (.+)$/
  - /^(?:I )?enable cookies$/
  - /^(?:I )?disable cookies$/
  - /^(?:I )?set cookie from (.+)$/
  - /^(?:I )?clear request cookies$/

When:
  - /^(?:I )?reset http client$/
  - /^(?:I )?(GET|POST|PUT|DELETE) (.+)$/
  - /^(?:I )?dump response body$/
  - /^(?:I )?dump response headers$/
  - /^(?:I )?dump response cookies$/

Then:
  - /^response status code should be ([1-5][0-9][0-9])$/
  - /^response status should be (.+)$/
  - /^response should (not )?have an? (.+) cookie$/
  - /^response (.+) cookie should (not )?be secure$/
  - /^response (.+) cookie should (not )?be http only$/
  - /^response (.+) cookie domain should (not )?be (.+)$/
  - /^(?:I )?json response should (fully )?match$/
  - /^(?:I )?should receive a collection of ([0-9]+) items?(?: for path )?(.+)?$/
  - /^response should match snapshot (.+)$/
  - /^response header (.+) should (not )?(equal|contain|match) (.+)$/</code></pre><h4>http API low level API</h4><p>When installed, you can access its client from the global cucumber context in your own step definitions.
For available methods on the client, please refer to its own
<a href="https://ekino.github.io/veggies/module-extensions_httpApi_client.html">documentation</a>.</p>
<pre class="prettyprint source lang-javascript"><code>defineSupportCode(({ When }) => {
    When(/^I do something useful$/, function() {
        return this.httpApiClient.makeRequest(/* … */)
    })
})</code></pre><h3>CLI extension</h3><h4>CLI installation</h4><p>The CLI extension relies on the <a href="#state-extension">state</a> &amp;
<a href="#fixtures-extension">fixtures</a> extensions, so make sure they're
registered prior to installation.</p>
<p>To install the extension, you should add the following snippet
to your <code>world</code> file:</p>
<pre class="prettyprint source lang-javascript"><code>// /support/world.js

const { defineSupportCode } = require('cucumber')
const { state, fixtures, cli } = require('@ekino/veggies')

defineSupportCode(({ setWorldConstructor }) => {
    setWorldConstructor(function() {
        state.extendWorld(this)
        fixtures.extendWorld(this)
        cli.extendWorld(this)
    })
})

state.install(defineSupportCode)
fixtures.install(defineSupportCode)
cli.install(defineSupportCode)</code></pre><h4>CLI gherkin expressions</h4><pre class="prettyprint source lang-yaml"><code>Given:
  - /^(?:I )?set (?:working directory|cwd) to (.+)$/
  - /^(?:I )?set ([^ ]+) (?:env|environment) (?:var|variable) to (.+)$/
  - /^(?:I )?set (?:env|environment) (?:vars|variables)$/
  - /^(?:I )?kill the process with ([^ ]+) in (\d+)(ms|s)/

When:
  - /^(?:I )?run command (.+)$/
  - /^(?:I )?dump (stderr|stdout)$/

Then:
  - /^(?:the )?(?:command )?exit code should be (\d+)$/
  - /^(stderr|stdout) should be empty$/
  - /^(stderr|stdout) should contain (.+)$/
  - /^(stderr|stdout) should not contain (.+)$/
  - /^(stderr|stdout) should match (.+)$/
  - /^(stderr|stdout) should not match (.+)$/</code></pre><h4>CLI low level API</h4><p>When installed, you can access it from the global cucumber context in your own step definitions.
For available methods on the client, please refer to its own
<a href="https://ekino.github.io/veggies/module-extensions_Cli_Cli.html">documentation</a>.</p>
<pre class="prettyprint source lang-javascript"><code>defineSupportCode(({ When }) => {
    Then(/^I check something from the CLI output$/, function() {
        const out = this.cli.getOutput()
        // …
    })
})</code></pre><h3>File system extension</h3><h4>File system installation</h4><p>The fileSystem extension relies on the <a href="#cli-extension">cli</a> extension,
so make sure it's registered prior to installation.</p>
<p>To install the extension, you should add the following snippet
to your <code>world</code> file:</p>
<pre class="prettyprint source lang-javascript"><code>// /support/world.js

const { defineSupportCode } = require('cucumber')
const { state, fixtures, cli, fileSystem } = require('@ekino/veggies')

defineSupportCode(({ setWorldConstructor }) => {
    setWorldConstructor(function() {
        state.extendWorld(this)
        fixtures.extendWorld(this)
        cli.extendWorld(this)
        fileSystem.extendWorld(this)
    })
})

state.install(defineSupportCode)
fixtures.install(defineSupportCode)
cli.install(defineSupportCode)
fileSystem.install(defineSupportCode)</code></pre><h4>File system gherkin expressions</h4><pre class="prettyprint source lang-yaml"><code>Given:
  # No definitions

When:
  # No definitions

Then:
  - /^(file|directory) (.+) should (not )?exist$/
  - /^file (.+) content should (not )?(equal|contain|match) (.+)$/</code></pre><h4>File system low level API</h4><p>When installed, you can access it from the global cucumber context in your own step definitions.
For available methods on the fileSystem, please refer to its own
<a href="https://ekino.github.io/veggies/module-extensions_Cli_Cli.html">documentation</a>.</p>
<pre class="prettyprint source lang-javascript"><code>defineSupportCode(({ Then }) => {
    Then(/^I check something using file system$/, function() {
        return this.fileSystem.getFileContent('whatever')
            .then(content => {
                // …    
            })
    })
})</code></pre><h2>Helpers</h2><h3>Cast helper</h3><p>Cast helper can be used to cast values for custom gherkin rules.
To find more about casting see <a href="#type-system">Type System</a>.</p>
<h4>Cast usage</h4><p>This must be used on gherkin arrays. Based on your array type you have to use: </p>
<ul>
<li><code>step.hashes()</code> -&gt; <code>Cast.objects(step.hashes())</code></li>
<li><code>step.rows()</code> -&gt; <code>Cast.array(step.rows())</code></li>
<li><code>step.raw()</code> -&gt; <code>Cast.array(step.raw())</code></li>
<li><code>step.rowsHash()</code> -&gt; <code>Cast.objects(step.rowsHash())</code></li>
</ul>
<p>For example:</p>
<pre class="prettyprint source lang-javascript"><code>const { cast } = require('@ekino/veggies')
const { defineSupportCode } = require('cucumber')

defineSupportCode(function({ Given, When, Then }) {
    Then(/^User data should be$/, (step) => {
        const userData = this.userData
        const expectedData = Cast.objects(step.rowsHash())
        expect(userData).to.be.deep.equal(expectedData)
    })
})</code></pre><h4>Add a type</h4><p>You can provide your own type.
For example:</p>
<pre class="prettyprint source lang-javascript"><code>Cast.addType('newType', value => value === 'true')</code></pre><p>Can be used on:</p>
<pre class="prettyprint source lang-gherkin"><code>  Given I get user id1 profile
  Then I should receive
    | id              | id1             |
    | age             | 1((number))     |
    | name            | veggies         |
    | isPublic        | true((newType)) |</code></pre><h2>Examples</h2><p>This repository comes with few examples, in order to run them, invoke the following script:</p>
<pre class="prettyprint source lang-sh"><code>yarn run examples</code></pre><p>If you want to only run certain examples, you can use tags, for example to run cli extension examples:</p>
<pre class="prettyprint source lang-sh"><code>yarn run examples -- --tags @cli</code></pre><p>There is a special tag which only runs examples not requiring network access:</p>
<pre class="prettyprint source lang-sh"><code>yarn run examples -- --tags @offline</code></pre><p>Due to public API rate limit (eg. GitHub API), this tag is used when running on CI.</p></article>
    </section>






</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Jul 19 2017 11:24:26 GMT+0900 (JST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
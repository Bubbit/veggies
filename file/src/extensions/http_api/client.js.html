<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/extensions/http_api/client.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  </ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/extensions/http_api/client.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;

const request = require(&apos;request&apos;).defaults({ json: true })

const BODY_TYPE_JSON = &apos;json&apos;
const BODY_TYPE_FORM = &apos;form&apos;

// REQUEST INFORMATION
let body = null
let bodyType = null
let headers = null
let query = null

// RESPONSE INFORMATION
let response = null

exports.reset = () =&gt; {
    body = null
    bodyType = null
    headers = null
    query = null
    response = null
}

exports.setJsonBody = payload =&gt; {
    bodyType = BODY_TYPE_JSON
    body = payload
}

exports.setFormBody = payload =&gt; {
    bodyType = BODY_TYPE_FORM
    body = payload
}

exports.setQuery = _query =&gt; {
    query = _query
}

exports.setHeaders = _headers =&gt; {
    headers = _headers
}

exports.setHeader = (key, value) =&gt; {
    headers = headers || {}
    headers[key] = value
}

exports.getResponse = () =&gt; response

exports.makeRequest = (method, path, baseUrl) =&gt; {
    return new Promise((resolve, reject) =&gt; {
        const options = {
            baseUrl: baseUrl,
            uri: path,
            method,
            qs: query || {},
            headers
        }

        if (body !== null) {
            if (![&apos;POST&apos;, &apos;PUT&apos;].includes(method)) {
                throw new Error(`You can only provides a body for POST and PUT HTTP methods, found: ${method}`)
            }

            if (bodyType === BODY_TYPE_JSON) {
                options.json = true
                options.body = body
            } else if (bodyType === BODY_TYPE_FORM) {
                options.form = body
            }
        }

        request(options, (_error, _response, _body) =&gt; {
            if (_error) {
                console.error(_error, options) // eslint-disable-line no-console
                reject()
            }

            response = _response
            resolve()
        })
    })
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
